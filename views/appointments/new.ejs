<%- include('../partials/header') %>

<div class="container py-5">
  <div class="text-center mb-4">
    <h2 class="fw-bold text-primary">ü©∫ Book a New Appointment</h2>
    <p class="text-muted">Fill in the details below to schedule a new appointment.</p>
  </div>

  <form action="/appointments" method="POST" 
        class="card shadow-lg p-4 col-lg-8 mx-auto border-0 rounded-4">
    
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="patient" class="form-label fw-semibold">Select Patient</label>
        <select class="form-select form-select-lg" id="patient" name="patient" required>
          <option value="">Choose Patient</option>
          <% patients.forEach(p => { %>
            <option value="<%= p._id %>"><%= p.name %> (<%= p.email %>)</option>
          <% }) %>
        </select>
      </div>

      <div class="col-md-6 mb-3">
        <label for="doctor" class="form-label fw-semibold">Select Doctor</label>
        <select class="form-select form-select-lg" id="doctor" name="doctor" required>
          <option value="">Choose Doctor</option>
          <% doctors.forEach(d => { %>
            <option 
              value="<%= d._id %>" 
              data-specialization="<%= d.specialization %>" 
              data-department="<%= d.department %>">
              Dr. <%= d.name %> (<%= d.specialization %>)
            </option>
          <% }) %>
        </select>
      </div>
    </div>

    <!-- Doctor Info Display -->
    <div id="doctorInfo" class="alert alert-info d-none">
      <strong>Specialization:</strong> <span id="docSpec"></span> <br>
      <strong>Department:</strong> <span id="docDept"></span>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="date" class="form-label fw-semibold">Date</label>
        <input type="date" class="form-control form-control-lg" id="date" name="date" required 
               min="<%= new Date().toISOString().split('T')[0] %>">
      </div>
      <div class="col-md-6 mb-3">
        <label for="timeSlot" class="form-label fw-semibold">Time Slot</label>
        <select class="form-select form-select-lg" id="timeSlot" name="timeSlot" required>
          <option value="">Select Time</option>
          <option value="9:00 AM - 10:00 AM">9:00 AM - 10:00 AM</option>
          <option value="10:00 AM - 11:00 AM">10:00 AM - 11:00 AM</option>
          <option value="11:00 AM - 12:00 PM">11:00 AM - 12:00 PM</option>
          <option value="2:00 PM - 3:00 PM">2:00 PM - 3:00 PM</option>
          <option value="3:00 PM - 4:00 PM">3:00 PM - 4:00 PM</option>
        </select>
      </div>
    </div>
    
    <div class="mb-3">
      <label for="reason" class="form-label fw-semibold">Reason for Visit</label>
      <textarea class="form-control form-control-lg" id="reason" name="reason" rows="3" 
                placeholder="Describe the purpose of visit..." required></textarea>
    </div>
    
    <div class="text-center mt-4">
      <button type="submit" class="btn btn-success btn-lg px-4 me-2 shadow-sm">
        ‚úÖ Confirm Appointment
      </button>
      <a href="/appointments" class="btn btn-outline-secondary btn-lg px-4">
        ‚ùå Cancel
      </a>
    </div>
  </form>
</div>

<!-- Doctor Info Script -->
<script>
  document.getElementById('doctor').addEventListener('change', function() {
    const selected = this.options[this.selectedIndex];
    const spec = selected.getAttribute('data-specialization');
    const dept = selected.getAttribute('data-department');
    const infoBox = document.getElementById('doctorInfo');
    const specEl = document.getElementById('docSpec');
    const deptEl = document.getElementById('docDept');
    
    if (this.value) {
      specEl.textContent = spec || 'Not specified';
      deptEl.textContent = dept || 'Not specified';
      infoBox.classList.remove('d-none');
      infoBox.classList.add('fade-in');
    } else {
      infoBox.classList.add('d-none');
    }
  });
</script>

<style>
  .form-select, .form-control {
    border-radius: 10px;
    box-shadow: none;
    transition: all 0.3s ease;
  }
  .form-select:focus, .form-control:focus {
    border-color: #0077b6;
    box-shadow: 0 0 6px rgba(0, 119, 182, 0.4);
  }
  .btn-success:hover {
    background-color: #0aa66e;
    transform: scale(1.03);
    transition: 0.2s ease;
  }
  .card {
    background-color: #f8fcff;
  }
  #doctorInfo {
    border-radius: 10px;
    background-color: #e8f4fa;
    transition: all 0.4s ease;
  }
  .fade-in {
    animation: fadeIn 0.5s ease-in-out;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>

<%- include('../partials/footer') %>
